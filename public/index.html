<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TEAM DISTRIBUTOR</title>
    <style>
      /* 리셋 및 기본 스타일 */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* 유틸리티 클래스 */
      .flex { display: flex; }
      .flex-between { justify-content: space-between; }
      .items-center { align-items: center; }
      .grid { display: grid; }
      .grid-3-cols { grid-template-columns: 250px 1fr 300px; }
      .min-h-screen { min-height: 100vh; }
      
      .p-4 { padding: 1rem; }
      .p-5 { padding: 1.25rem; }
      .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
      .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
      .mb-4 { margin-bottom: 1rem; }
      .mb-5 { margin-bottom: 1.25rem; }
      .mt-3 { margin-top: 0.75rem; }
      .ml-2 { margin-left: 0.5rem; }

      .rounded { border-radius: 0.25rem; }
      .rounded-md { border-radius: 0.375rem; }
      
      .text-sm { font-size: 0.875rem; }
      .text-base { font-size: 1rem; }
      .text-lg { font-size: 1.125rem; }
      .font-bold { font-weight: bold; }
      .uppercase { text-transform: uppercase; }
      .text-center { text-align: center; }

      .cursor-pointer { cursor: pointer; }
      .transition { transition: all 0.3s ease; }
      .shadow-sm { box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); }
      .hidden { display: none; }

      /* 테마 색상 */
      .bg-dark { background-color: #1e1e1e; }
      .bg-dark-2 { background-color: #252526; }
      .bg-dark-3 { background-color: #2d2d2d; }
      .bg-dark-4 { background-color: #3c3c3c; }
      .bg-error { background-color: #4c2727; }
      .bg-primary { background-color: cadetblue; }

      .text-white { color: #ffffff; }
      .text-gray { color: #969696; }
      .text-light { color: #d4d4d4; }

      .border-dark { border: 1px solid #3c3c3c; }
      .border-error { border: 1px solid #ff4444; }
      .border-focus { border: 1px solid #007acc; }

      /* 컴포넌트 기본 스타일 */
      .btn {
        padding: 0.75rem 1.25rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
        min-width: 80px;
      }

      .btn-primary {
        background-color: cadetblue;
        color: white;
      }

      .btn-primary:hover {
        background-color: #4f9a9a;
      }

      .btn-secondary {
        background-color: #3c3c3c;
        color: white;
      }

      .btn-secondary:hover {
        background-color: #4c4c4c;
      }

      .btn[disabled] {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .input {
        width: 100%;
        padding: 0.75rem 1rem;
        border-radius: 0.25rem;
        background-color: #3c3c3c;
        color: white;
        border: 1px solid #4c4c4c;
        transition: all 0.3s ease;
        font-size: 0.875rem;
      }

      .input:focus {
        border-color: #007acc;
        outline: none;
        background-color: #454545;
      }

      .input.invalid {
        background-color: #4c2727;
        border-color: #ff4444;
      }

      .input:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* 상태 메시지 스타일 */
      .status-message {
        padding: 0.75rem 1rem;
        border-radius: 0.25rem;
        background-color: #252526;
        color: #d4d4d4;
        font-size: 0.875rem;
        line-height: 1.5;
        border: 1px solid #3c3c3c;
      }

      /* 멤버 아이템 스타일 */
      .member-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem;
        background-color: #2d2d2d;
        margin: 0.5rem 0;
        border-radius: 0.25rem;
        border: 1px solid #3c3c3c;
      }

      .member-item .btn {
        padding: 0.5rem 1rem;
        min-width: 60px;
        margin-left: 0.5rem;
      }

      .member-name {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      /* 접미사 입력 스타일 */
      .suffix-input {
        width: 100px;
        padding: 0.5rem 0.75rem;
        margin-right: 0.5rem;
        background-color: #3c3c3c;
        color: white;
        border: 1px solid #4c4c4c;
        border-radius: 0.25rem;
        font-size: 0.875rem;
      }

      .suffix-input:focus {
        border-color: #007acc;
        outline: none;
        background-color: #454545;
      }

      /* 완료 메시지 스타일 */
      .completion-message {
        background-color: cadetblue;
        color: white;
        padding: 1rem;
        border-radius: 0.375rem;
        text-align: center;
        font-weight: 500;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* 애니메이션 */
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }

      .shake {
        animation: shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
      }

      /* 스핀 버튼 스타일 */
      .number-input::-webkit-inner-spin-button,
      .number-input::-webkit-outer-spin-button {
        opacity: 1;
        height: 30px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="grid grid-3-cols min-h-screen">
      <!-- 네비게이터 영역 -->
      <nav class="bg-dark-2 text-white p-5 border-dark">
        <div class="mb-5">
          <h2 class="text-gray text-sm uppercase mb-4">기능</h2>
          <div class="nav-item px-3 py-2 rounded cursor-pointer">팀 생성</div>
          <div class="nav-item px-3 py-2 rounded cursor-pointer">팀 관리</div>
          <div class="nav-item px-3 py-2 rounded cursor-pointer">설정</div>
        </div>
        <div class="mb-5">
          <h2 class="text-gray text-sm uppercase mb-4">최근 기록</h2>
          <div class="nav-item px-3 py-2 rounded cursor-pointer">저장된 팀 목록</div>
          <div class="nav-item px-3 py-2 rounded cursor-pointer">히스토리</div>
        </div>
      </nav>

      <!-- 메인 컨텐츠 영역 -->
      <main class="bg-dark p-5 text-light">
        <div class="bg-dark-3 rounded-md p-4 shadow-sm mb-4">
          <h2 class="text-lg text-white mb-4">멤버 목록</h2>
          <ul class="member-list"></ul>
        </div>
        <div class="completion-message bg-primary text-white p-4 rounded-md text-center mt-3 hidden">
          작성 완료! 모든 멤버가 등록되었습니다.
        </div>
      </main>

      <!-- 입력 패널 -->
      <aside class="bg-dark-2 p-5 border-dark">
        <!-- 총원 설정 카드 -->
        <div class="bg-dark-3 rounded-md p-4 shadow-sm mb-4">
          <h3 class="text-lg text-white mb-4">총원 설정</h3>
          <input
            type="number"
            class="number-input input mb-4"
            min="1"
            placeholder="총 인원"
          />
          <div class="flex">
            <button class="btn btn-primary confirm-total">완료</button>
            <button class="btn btn-secondary edit-total ml-2 hidden">수정</button>
          </div>
          <div class="status-message mt-3"></div>
        </div>

        <!-- 멤버 입력 카드 -->
        <div class="bg-dark-3 rounded-md p-4 shadow-sm">
          <h3 class="text-lg text-white mb-4">멤버 추가</h3>
          <input
            type="text"
            class="member-input input mb-4"
            placeholder="멤버 이름을 입력하세요"
            disabled
          />
          <button class="btn btn-secondary add-member" disabled>추가</button>
        </div>
      </aside>
    </div>

    <script>
      const TeamDistributor = {
        selectors: {
          memberInput: '.member-input',
          memberList: '.member-list',
          addMemberBtn: '.add-member',
          totalInput: '.number-input',
          statusMessage: '.status-message',
          confirmTotalBtn: '.confirm-total',
          editTotalBtn: '.edit-total',
          completionMessage: '.completion-message'
        },

        state: {
          members: [],
          totalMembers: 0,
          isTotalConfirmed: false
        },

        init() {
          this.bindElements();
          this.bindEvents();
          this.updateStatusMessage();
        },

        bindElements() {
          this.elements = {};
          for (const [key, selector] of Object.entries(this.selectors)) {
            this.elements[key] = document.querySelector(selector);
          }
        },

        bindEvents() {
          this.elements.confirmTotalBtn.addEventListener("click", () => this.confirmTotalMembers());
          this.elements.editTotalBtn.addEventListener("click", () => this.editTotalMembers());
          this.elements.addMemberBtn.addEventListener("click", () => this.addMember());
          this.elements.memberInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") this.addMember();
          });
          
          // 총원 입력 필드 이벤트
          this.elements.totalInput.addEventListener("input", (e) => {
            if (!this.state.isTotalConfirmed) {
              const input = e.target;
              const value = input.value;
              
              // 숫자와 정수 검증
              if (!/^\d*$/.test(value)) {
                input.value = value.replace(/[^\d]/g, '');
                this.showInvalidInput(input);
                return;
              }

              const numValue = parseInt(value);
              if (numValue < 1) {
                input.value = "";
                this.showInvalidInput(input);
                this.updateTotalMembers(0);
                return;
              }

              input.classList.remove('invalid');
              this.updateTotalMembers(numValue);
            }
          });

          // 총원 입력 필드 엔터키 이벤트 추가
          this.elements.totalInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter" && !this.state.isTotalConfirmed) {
              const value = parseInt(e.target.value);
              if (!value || value < 1) {
                this.showInvalidInput(e.target);
                return;
              }
              this.confirmTotalMembers();
            }
          });
        },

        updateTotalMembers(value) {
          const parsedValue = parseInt(value);
          this.state.totalMembers = !isNaN(parsedValue) && parsedValue > 0 ? parsedValue : 0;
          this.updateStatusMessage();
          this.updateInputState();
        },

        updateStatusMessage() {
          const { statusMessage } = this.elements;
          const { totalMembers, members, isTotalConfirmed } = this.state;

          if (!isTotalConfirmed) {
            statusMessage.textContent = "총원을 입력하고 완료 버튼을 클릭하거나 엔터를 눌러주세요.";
            return;
          }

          if (totalMembers === 0) {
            statusMessage.textContent = "총원을 입력해주세요.";
            return;
          }

          const remaining = totalMembers - members.length;
          if (remaining > 0) {
            statusMessage.textContent = `${totalMembers}명 중 ${members.length}명 작성됨 (${remaining}명 남음)`;
          } else if (remaining === 0) {
            statusMessage.textContent = `${totalMembers}명 모두 작성 완료!`;
          } else {
            statusMessage.textContent = `설정된 총원(${totalMembers}명)을 초과했습니다!`;
          }
        },

        updateInputState() {
          const { memberInput, addMemberBtn, completionMessage } = this.elements;
          const { totalMembers, members, isTotalConfirmed } = this.state;

          const canAddMore = isTotalConfirmed && totalMembers > 0 && members.length < totalMembers;

          memberInput.disabled = !canAddMore;
          addMemberBtn.disabled = !canAddMore;

          if (!canAddMore) {
            memberInput.classList.add("disabled");
            addMemberBtn.classList.add("disabled");
          } else {
            memberInput.classList.remove("disabled");
            addMemberBtn.classList.remove("disabled");
          }

          if (totalMembers > 0 && members.length === totalMembers) {
            completionMessage.style.display = "block";
          } else {
            completionMessage.style.display = "none";
          }
        },

        showInvalidInput(element) {
          element.classList.add('invalid');
          element.classList.remove('shake');
          // 리플로우를 강제로 발생시켜 애니메이션이 다시 시작되도록 함
          void element.offsetWidth;
          element.classList.add('shake');
        },

        confirmTotalMembers() {
          const { totalInput, confirmTotalBtn, editTotalBtn } = this.elements;
          const value = parseInt(totalInput.value);

          if (!value || value < 1) {
            this.showInvalidInput(totalInput);
            return;
          }

          totalInput.classList.remove('invalid');
          totalInput.disabled = true;
          confirmTotalBtn.style.display = "none";
          editTotalBtn.style.display = "block";
          this.state.isTotalConfirmed = true;

          this.updateInputState();
        },

        editTotalMembers() {
          const { totalInput, confirmTotalBtn, editTotalBtn } = this.elements;

          if (this.state.members.length > 0) {
            if (!confirm("총원을 수정하면 입력된 멤버 목록이 초기화됩니다. 계속하시겠습니까?")) {
              return;
            }
            this.state.members = [];
            this.updateMemberList();
          }

          totalInput.disabled = false;
          confirmTotalBtn.style.display = "block";
          editTotalBtn.style.display = "none";
          this.state.isTotalConfirmed = false;

          this.updateInputState();
          this.elements.completionMessage.style.display = "none";
        },

        addMember() {
          const { memberInput } = this.elements;
          const { totalMembers, members } = this.state;

          if (members.length >= totalMembers) {
            this.showInvalidInput(memberInput);
            return;
          }

          let name = memberInput.value.trim();

          if (!name) {
            this.showInvalidInput(memberInput);
            return;
          }

          memberInput.classList.remove('invalid');

          const sameNames = members.filter(
            (member) =>
              member === name ||
              member.startsWith(name + "-") ||
              member.replace(/-\d+$/, "") === name
          );

          if (sameNames.length > 0) {
            const baseNameIndex = members.findIndex((member) => member === name);
            if (baseNameIndex !== -1) {
              members[baseNameIndex] = `${name}-1`;
            }
            name = `${name}-${sameNames.length + 1}`;
          }

          this.state.members.push(name);
          this.updateMemberList();
          this.updateStatusMessage();
          this.updateInputState();
          memberInput.value = "";
        },

        removeMember(index) {
          this.state.members.splice(index, 1);
          this.updateMemberList();
          this.updateStatusMessage();
          this.updateInputState();
        },

        startSuffixEdit(event, index) {
          event.preventDefault();
          const nameSpan = event.target.parentElement;
          const name = this.state.members[index];

          if (nameSpan.querySelector(".edit-mode")) return;

          const [baseName, currentSuffix] = name.split("-");

          const editMode = document.createElement("span");
          editMode.className = "edit-mode";

          const input = document.createElement("input");
          input.type = "text";
          input.value = currentSuffix || "";
          input.className = "suffix-input";
          input.placeholder = "접미사 입력";

          const confirmBtn = document.createElement("button");
          confirmBtn.className = "btn btn-primary";
          confirmBtn.textContent = "확정";

          editMode.appendChild(input);
          editMode.appendChild(confirmBtn);

          const originalContent = nameSpan.innerHTML;
          nameSpan.innerHTML = `${baseName}-`;
          nameSpan.appendChild(editMode);

          const handleConfirm = () => {
            const newSuffix = input.value.trim();

            if (!newSuffix) {
              nameSpan.innerHTML = originalContent;
              return;
            }

            const isDuplicate = this.state.members.some(
              (m, i) => i !== index && m === `${baseName}-${newSuffix}`
            );

            if (isDuplicate) {
              alert("이미 사용 중인 접미사입니다.");
              nameSpan.innerHTML = originalContent;
              return;
            }

            this.state.members[index] = `${baseName}-${newSuffix}`;
            this.updateMemberList();
          };

          confirmBtn.addEventListener("click", handleConfirm);
          input.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              handleConfirm();
            }
          });

          input.addEventListener("blur", (e) => {
            if (e.relatedTarget !== confirmBtn) {
              nameSpan.innerHTML = originalContent;
            }
          });

          input.focus();
        },

        updateMemberList() {
          const { memberList } = this.elements;

          while (memberList.firstChild) {
            memberList.firstChild.remove();
          }

          this.state.members.forEach((name, index) => {
            const li = document.createElement("li");
            li.className = "member-item";

            const nameSpan = document.createElement("span");
            nameSpan.className = "member-name";
            nameSpan.dataset.index = index;

            const deleteBtn = document.createElement("button");
            deleteBtn.className = "btn btn-secondary";
            deleteBtn.dataset.index = index;
            deleteBtn.textContent = "삭제";

            deleteBtn.addEventListener("click", () => this.removeMember(index));

            if (name.includes("-")) {
              const [baseName, suffix] = name.split("-");
              nameSpan.textContent = `${baseName}-${suffix}`;

              const editBtn = document.createElement("button");
              editBtn.className = "btn btn-secondary";
              editBtn.style.marginLeft = "8px";
              editBtn.textContent = "수정";
              editBtn.addEventListener("click", (e) => this.startSuffixEdit(e, index));

              nameSpan.appendChild(editBtn);
            } else {
              nameSpan.textContent = name;
            }

            li.appendChild(nameSpan);
            li.appendChild(deleteBtn);
            memberList.appendChild(li);
          });
        },
      };

      document.addEventListener('DOMContentLoaded', () => {
        TeamDistributor.init();
      });
    </script>
  </body>
</html>
