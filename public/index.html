<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TEAM DISTRIBUTOR</title>
    <style>
      /* 유틸리티 클래스 스타일링 */
      .mx-auto { margin: 0 auto; }
      .p-20 { padding: 20px; }
      .my-20 { margin: 20px 0; }
      .p-8 { padding: 8px; }
      .my-4 { margin: 4px 0; }
      
      /* 레이아웃 */
      .flex { display: flex; }
      .justify-between { justify-content: space-between; }
      .max-w-600 { max-width: 600px; }
      
      /* 리스트 스타일 */
      .list-none { list-style: none; }
      .p-0 { padding: 0; }
      
      /* 시각적 스타일 */
      .bg-gray { background-color: #f5f5f5; }
      .rounded { border-radius: 4px; }
      .text-red { color: red; }
      .cursor-pointer { cursor: pointer; }
      
      /* 수정 가능한 숫자 스타일 추가 */
      .number-edit {
        color: #0066cc;
        cursor: pointer;
        padding: 0 4px;
      }
      .number-edit:hover {
        background-color: #e6f0ff;
        border-radius: 2px;
      }
      .number-input {
        width: 40px;
        padding: 2px;
        border: 1px solid #0066cc;
        border-radius: 2px;
        font-size: inherit;
      }
      
      /* 수정 가능한 접미사 스타일 수정 */
      .suffix-edit {
        color: #0066cc;
        cursor: pointer;
        padding: 0 4px;
        font-style: italic; /* 수정 가능함을 시각적으로 표시 */
      }
      .suffix-edit:hover {
        background-color: #e6f0ff;
        border-radius: 2px;
      }
      .suffix-input {
        width: auto;
        min-width: 60px;
        padding: 2px 4px;
        border: 1px solid #0066cc;
        border-radius: 2px;
        font-size: inherit;
      }
    </style>
  </head>
  <body>
    <div id="team-distributor" class="max-w-600 mx-auto p-20">
      <h1>TEAM DISTRIBUTOR</h1>

      <!-- 멤버 입력 폼 -->
      <div class="my-20">
        <input 
          type="text" 
          id="member-input" 
          placeholder="멤버 이름을 입력하세요" 
          class="p-8"
        />
        <button 
          id="add-member-btn"
          class="p-8 cursor-pointer"
        >추가</button>
      </div>

      <!-- 멤버 목록 표시 -->
      <div>
        <h2>멤버 목록</h2>
        <ul id="member-list" class="list-none p-0"></ul>
      </div>
    </div>

    <script>
      // 멤버 목록을 저장할 배열
      let members = [];

      // DOM 요소
      const memberInput = document.getElementById("member-input");
      const memberList = document.getElementById("member-list");
      const addMemberBtn = document.getElementById("add-member-btn");

      // 멤버 추가 함수
      function addMember() {
        let name = memberInput.value.trim();

        // 입력값 검증
        if (!name) {
          alert("이름을 입력해주세요.");
          return;
        }

        // 동명이인 처리
        const sameNames = members.filter(member => 
          member === name || // 정확히 같은 이름
          member.startsWith(name + '-') || // 넘버링이 있는 같은 이름
          member.replace(/-\d+$/, '') === name // 넘버링을 제거했을 때 같은 이름
        );

        if (sameNames.length > 0) {
          // 기존의 넘버링되지 않은 동일 이름을 찾아서 넘버링 추가
          const baseNameIndex = members.findIndex(member => member === name);
          if (baseNameIndex !== -1) {
            members[baseNameIndex] = `${name}-1`;
          }

          // 새로운 멤버에 대한 넘버링
          name = `${name}-${sameNames.length + 1}`;
        }

        // 멤버 추가
        members.push(name);

        // UI 업데이트
        updateMemberList();

        // 입력창 초기화
        memberInput.value = "";
      }

      // 멤버 삭제 함수
      function removeMember(index) {
        members.splice(index, 1);
        updateMemberList();
      }

      // 멤버 목록 UI 업데이트 함수 수정
      function updateMemberList() {
        while (memberList.firstChild) {
          memberList.firstChild.remove();
        }

        members.forEach((name, index) => {
          const li = document.createElement('li');
          li.className = 'flex justify-between p-8 my-4 bg-gray rounded';

          const nameSpan = document.createElement('span');
          nameSpan.className = 'member-name';
          nameSpan.dataset.index = index;

          const deleteBtn = document.createElement('span');
          deleteBtn.className = 'text-red cursor-pointer';
          deleteBtn.dataset.index = index;
          deleteBtn.textContent = '×';

          deleteBtn.addEventListener('click', () => removeMember(index));

          if (name.includes('-')) {
            const [baseName, suffix] = name.split('-');
            const suffixSpan = document.createElement('span');
            suffixSpan.className = 'suffix-edit';
            suffixSpan.textContent = suffix;
            suffixSpan.title = '클릭하여 수정'; // 툴팁 추가

            nameSpan.textContent = `${baseName}-`;
            nameSpan.appendChild(suffixSpan);

            suffixSpan.addEventListener('click', (e) => startSuffixEdit(e, index));
          } else {
            nameSpan.textContent = name;
          }

          li.appendChild(nameSpan);
          li.appendChild(deleteBtn);
          memberList.appendChild(li);
        });
      }

      // 접미사 수정 함수
      function startSuffixEdit(event, index) {
        const suffixSpan = event.target;
        const name = members[index];
        
        if (suffixSpan.querySelector('input')) return;

        const [baseName, currentSuffix] = name.split('-');
        
        const input = document.createElement('input');
        input.type = 'text';
        input.value = currentSuffix;
        input.className = 'suffix-input';
        input.placeholder = '접미사 입력';
        
        function handleEdit(e) {
          const newSuffix = e.target.value.trim();
          
          // 빈 값 체크
          if (!newSuffix) {
            updateMemberList();
            return;
          }

          // 중복 체크
          const isDuplicate = members.some((m, i) => 
            i !== index && m === `${baseName}-${newSuffix}`
          );

          if (isDuplicate) {
            alert('이미 사용 중인 접미사입니다.');
            updateMemberList();
            return;
          }

          members[index] = `${baseName}-${newSuffix}`;
          updateMemberList();
        }

        function handleBlur(e) {
          handleEdit(e);
          input.removeEventListener('blur', handleBlur);
          input.removeEventListener('keypress', handleKeyPress);
        }

        function handleKeyPress(e) {
          if (e.key === 'Enter') {
            handleEdit(e);
            input.blur();
          }
        }

        input.addEventListener('blur', handleBlur);
        input.addEventListener('keypress', handleKeyPress);

        suffixSpan.textContent = '';
        suffixSpan.appendChild(input);
        input.focus();
      }

      // 이벤트 리스너 등록
      addMemberBtn.addEventListener("click", addMember);
      memberInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          addMember();
        }
      });
    </script>
  </body>
</html>
